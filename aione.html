<html>
    <head>
        <title>All in One Recorder</title>
        <author>HanishKVC</author>
        <version>v20230702IST1755</version>
    </head>
    <body>
        <h1>All in One Recorder</h1>
        <p>
            <button id="RecScr"> Record Screen </button>
            <button id="RecDev"> Record Devices </button>
            <button id="RecStop"> Stop </button>
        </p>
        <script>
            let theStream = null
            let mediaRec = null;
            let mediaChunks = []

            function prep_mr(stream) {
                    theStream = stream
                    mediaRec = new MediaRecorder(stream)
                    mediaRec.ondataavailable = (be) => mediaChunks.push(be.data)
                    mediaRec.start()
            }

            function start_rs(params) {
                navigator.mediaDevices.getDisplayMedia({audio: true, video: true}).then((stream)=>{
                    prep_mr(stream)
                    console.log("INFO:RecScr:Started...")
                })
            }

            function start_rd(params) {
                navigator.mediaDevices.getUserMedia({audio: true, video: true}).then((stream)=>{
                    prep_mr(stream)
                    console.log("INFO:RecDev:Started...")
                })
            }

            function stop_rec(params) {
                if (mediaRec !== null) {
                    mediaRec.stop()
                    mediaRec = null
                    console.log("INFO:RecStop:Stopped recording...")
                    console.log("INFO:RecStop:NumOfMediaChunts:", mediaChunks.length)
                }
            }

            function init (params) {
                let brs = document.getElementById("RecScr")
                brs.onclick = start_rs
                let brd = document.getElementById("RecDev")
                brd.onclick = start_rd
                let brstop = document.getElementById("RecStop")
                brstop.onclick = stop_rec
                console.log("INFO:Init:Setup UI...")
            }
            window.onload = init
        </script>
    </body>
</html>
